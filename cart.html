<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cart — MERIDIAN</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <script>(function(){if(localStorage.getItem('meridian_theme')==='light'){document.documentElement.classList.add('light-theme');}}());</script>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* ── Cart-page supplemental styles ── */

    .cart-page {
      padding-top: calc(72px + 4rem);
      padding-bottom: 8rem;
      min-height: 100vh;
    }

    .cart-page__header {
      margin-bottom: 3rem;
    }

    .cart-page__eyebrow {
      display: block;
      font-size: 0.65rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--color-copper);
      margin-bottom: 0.75rem;
    }

    .cart-page__title {
      font-family: var(--font-serif);
      font-size: clamp(2rem, 4vw, 2.75rem);
      font-weight: 300;
      color: var(--color-text);
      margin-bottom: 0.5rem;
    }

    .cart-page__count {
      font-size: 0.85rem;
      color: var(--color-text-faint);
    }

    /* Layout: two-column on desktop */
    .cart-page__body {
      display: grid;
      grid-template-columns: 1fr;
      gap: 3rem;
      align-items: start;
    }

    @media (min-width: 900px) {
      .cart-page__body {
        grid-template-columns: 1fr 360px;
        gap: 4rem;
      }
    }

    /* ── Items table ── */
    .cart-items {
      display: flex;
      flex-direction: column;
    }

    .cart-items__heading {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      gap: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--color-border-light);
      font-size: 0.65rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--color-text-faint);
    }

    .cart-items__heading-price,
    .cart-items__heading-qty,
    .cart-items__heading-total {
      text-align: right;
    }

    .cart-items__list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }

    .cart-row {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      gap: 1rem;
      align-items: center;
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--color-border);
    }

    .cart-row__name {
      font-size: 0.9rem;
      color: var(--color-text);
      line-height: 1.4;
    }

    .cart-row__price {
      font-size: 0.9rem;
      color: var(--color-text-muted);
      text-align: right;
      white-space: nowrap;
    }

    /* Quantity controls */
    .qty-control {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      justify-content: flex-end;
    }

    .qty-control__btn {
      width: 28px;
      height: 28px;
      background: var(--color-surface-2);
      border: 1px solid var(--color-border-light);
      color: var(--color-text);
      font-size: 1rem;
      line-height: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: border-color 0.2s, color 0.2s;
    }

    .qty-control__btn:hover {
      border-color: var(--color-copper);
      color: var(--color-copper);
    }

    .qty-control__val {
      min-width: 2rem;
      text-align: center;
      font-size: 0.875rem;
      color: var(--color-text);
    }

    .cart-row__total {
      font-size: 0.9rem;
      color: var(--color-text);
      text-align: right;
      white-space: nowrap;
    }

    .cart-row__remove {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      margin-left: 0.5rem;
    }

    .cart-row__remove-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--color-text-faint);
      padding: 0.25rem;
      line-height: 1;
      transition: color 0.2s;
    }

    .cart-row__remove-btn:hover {
      color: #c0392b;
    }

    /* Mobile: stack grid columns */
    @media (max-width: 600px) {
      .cart-items__heading { display: none; }
      .cart-row {
        grid-template-columns: 1fr auto;
        grid-template-rows: auto auto;
        gap: 0.75rem;
      }
      .cart-row__price { display: none; }
      .cart-row__total { grid-column: 1; grid-row: 2; text-align: left; }
      .qty-control { grid-column: 2; grid-row: 2; }
      .cart-row__remove { grid-column: 2; grid-row: 1; }
    }

    /* Empty state */
    .cart-empty-state {
      padding: 4rem 0;
      text-align: center;
      color: var(--color-text-muted);
    }

    .cart-empty-state p {
      margin-bottom: 2rem;
      font-size: 0.95rem;
    }

    /* Continue shopping */
    .cart-page__continue {
      margin-top: 1.75rem;
    }

    .cart-page__continue a {
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--color-text-faint);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: color 0.2s;
    }

    .cart-page__continue a:hover {
      color: var(--color-copper);
    }

    /* ── Order summary panel ── */
    .order-summary {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      padding: 2rem;
      position: sticky;
      top: calc(72px + 1rem);
    }

    .order-summary__title {
      font-family: var(--font-serif);
      font-size: 1.2rem;
      font-weight: 400;
      color: var(--color-text);
      margin-bottom: 1.75rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--color-border);
    }

    .order-summary__lines {
      display: flex;
      flex-direction: column;
      gap: 0.875rem;
      margin-bottom: 1.5rem;
    }

    .summary-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
    }

    .summary-line__label {
      color: var(--color-text-muted);
    }

    .summary-line__value {
      color: var(--color-text);
    }

    .summary-line__value--tbd {
      color: var(--color-text-faint);
      font-size: 0.8rem;
      font-style: italic;
    }

    .order-summary__divider {
      border: none;
      border-top: 1px solid var(--color-border-light);
      margin: 1.25rem 0;
    }

    .summary-line--total .summary-line__label {
      font-size: 0.95rem;
      color: var(--color-text);
      font-weight: 500;
    }

    .summary-line--total .summary-line__value {
      font-family: var(--font-serif);
      font-size: 1.2rem;
      color: var(--color-text);
    }

    .checkout-btn {
      display: block;
      width: 100%;
      padding: 1rem;
      background: var(--color-copper);
      color: var(--color-bg);
      border: none;
      font-family: var(--font-sans);
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 1.5rem;
    }

    .checkout-btn:hover {
      background: var(--color-copper-light);
    }

    .checkout-btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .order-summary__note {
      margin-top: 1rem;
      font-size: 0.75rem;
      color: var(--color-text-faint);
      text-align: center;
      line-height: 1.6;
    }

    .order-summary__security {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      margin-top: 0.75rem;
      font-size: 0.7rem;
      color: var(--color-text-faint);
      letter-spacing: 0.05em;
    }

    .order-summary__security svg {
      color: var(--color-copper);
      flex-shrink: 0;
    }

    /* Cart sidebar drawer (same as other pages) */
    .cart-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.65);
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .cart-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    .cart-sidebar {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: min(420px, 100vw);
      background: var(--color-surface);
      border-left: 1px solid var(--color-border);
      z-index: 201;
      transform: translateX(100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
    }

    .cart-sidebar.open {
      transform: translateX(0);
    }
  </style>
</head>
<body>

  <!-- ══════════════ NAV ══════════════ -->
  <nav class="nav">
    <div class="container">
      <div class="nav__inner">

        <a href="index.html" class="nav-logo">
          <div class="nav-logo__mark">
            <div class="nav-logo__mark-inner"></div>
          </div>
          <span class="nav-logo__text">Meridian</span>
        </a>

        <ul class="nav-links">
          <li><a href="index.html" class="nav-links__item">Home</a></li>
          <li><a href="products.html" class="nav-links__item">Products</a></li>
          <li><a href="about.html" class="nav-links__item">Our Story</a></li>
        </ul>

        <div class="nav-cta">
          <button
            class="nav-cart"
            id="cartToggleBtn"
            aria-label="Open cart"
          >
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <path d="M16 10a4 4 0 01-8 0"/>
            </svg>
            <span class="nav-cart__count" id="cartBadge" style="display:none;"></span>
          </button>
        </div>

        <button class="nav-theme-toggle" id="themeToggle" aria-label="Switch to light theme"><svg class="theme-icon theme-icon--sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg class="theme-icon theme-icon--moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button>
        <button class="nav-hamburger" aria-label="Open menu">
          <span class="nav-hamburger__line"></span>
          <span class="nav-hamburger__line"></span>
          <span class="nav-hamburger__line"></span>
        </button>

      </div>
    </div>
  </nav>

  <!-- Mobile drawer -->
  <nav class="nav-drawer">
    <ul class="nav-drawer__links">
      <li><a href="index.html" class="nav-drawer__link">Home</a></li>
      <li><a href="products.html" class="nav-drawer__link">Products</a></li>
      <li><a href="about.html" class="nav-drawer__link">Our Story</a></li>
    </ul>
    <div class="nav-drawer__footer">
      <p>Hand-crafted tools. Ancient practice.</p>
    </div>
  </nav>
  <div class="nav-backdrop"></div>

  <!-- Cart drawer (mini sidebar — still accessible from nav) -->
  <div class="cart-overlay" id="cartOverlay"></div>
  <div class="cart-sidebar" id="cartSidebar"></div>


  <!-- ══════════════ CART PAGE ══════════════ -->
  <main class="cart-page">
    <div class="container">

      <header class="cart-page__header">
        <span class="cart-page__eyebrow">Your selection</span>
        <h1 class="cart-page__title">Your Cart</h1>
        <p class="cart-page__count" id="cartPageCount"></p>
      </header>

      <div class="cart-page__body">

        <!-- LEFT: Items list -->
        <div class="cart-items" id="cartItemsColumn">
          <!-- Populated by JS -->
        </div>

        <!-- RIGHT: Order summary -->
        <aside class="order-summary" id="orderSummary">
          <!-- Populated by JS -->
        </aside>

      </div><!-- /.cart-page__body -->

    </div>
  </main>


  <!-- ══════════════ FOOTER ══════════════ -->
  <footer class="footer">
    <div class="container">
      <div class="footer__grid">
        <div class="footer__brand">
          <span class="footer__brand-logo">Meridian</span>
          <p class="footer__brand-desc">
            Hand-crafted copper and wood tools grounded in Traditional Chinese Medicine
            and anatomical precision.
          </p>
        </div>
        <div>
          <p class="footer__col-title">Navigate</p>
          <ul class="footer__links">
            <li><a href="index.html" class="footer__link">Home</a></li>
            <li><a href="products.html" class="footer__link">Products</a></li>
            <li><a href="about.html" class="footer__link">Our Story</a></li>
            <li><a href="cart.html" class="footer__link">Cart</a></li>
          </ul>
        </div>
        <div>
          <p class="footer__col-title">Practice</p>
          <ul class="footer__links">
            <li><a href="#" class="footer__link">How to use</a></li>
            <li><a href="#" class="footer__link">Meridian guide</a></li>
            <li><a href="#" class="footer__link">Care &amp; storage</a></li>
          </ul>
        </div>
        <div class="footer__newsletter">
          <p class="footer__col-title">Stay in practice</p>
          <p>Technique guides, new tools, and practitioner notes.</p>
          <form class="footer__newsletter-form" onsubmit="return false;">
            <input
              type="email"
              class="footer__newsletter-input"
              placeholder="your@email.com"
              aria-label="Email address"
            />
            <button type="submit" class="footer__newsletter-btn">Subscribe</button>
          </form>
        </div>
      </div>
      <div class="footer__bottom">
        <p class="footer__copyright">&copy; 2026 MERIDIAN. All rights reserved.</p>
        <div class="footer__legal">
          <a href="#" class="footer__legal-link">Privacy Policy</a>
          <a href="#" class="footer__legal-link">Terms</a>
          <a href="#" class="footer__legal-link">Shipping</a>
        </div>
      </div>
    </div>
  </footer>


  <script src="js/cart.js"></script>
  <script src="js/main.js"></script>
  <script>
    /* ── Cart page renderer ── */
    (function () {
      'use strict';

      function formatPrice(n) {
        return '$' + Number(n).toFixed(2);
      }

      function escHtml(str) {
        return String(str)
          .replace(/&/g, '&amp;').replace(/</g, '&lt;')
          .replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
      }

      function svgArrowLeft() {
        return '<svg width="14" height="14" viewBox="0 0 24 24" fill="none"'
             + ' stroke="currentColor" stroke-width="1.5" stroke-linecap="round"'
             + ' stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/>'
             + '<polyline points="12 19 5 12 12 5"/></svg>';
      }

      function svgTrash() {
        return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"'
             + ' stroke-linecap="round" stroke-linejoin="round" width="15" height="15">'
             + '<polyline points="3 6 5 6 21 6"/>'
             + '<path d="M19 6l-1 14H6L5 6"/>'
             + '<path d="M10 11v6"/><path d="M14 11v6"/>'
             + '<path d="M9 6V4h6v2"/></svg>';
      }

      function svgLock() {
        return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"'
             + ' stroke-linecap="round" stroke-linejoin="round" width="12" height="12">'
             + '<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>'
             + '<path d="M7 11V7a5 5 0 0110 0v4"/></svg>';
      }

      function renderCartPage() {
        var cart = window.MeridianCart ? window.MeridianCart.getCart() : [];
        var total = window.MeridianCart ? window.MeridianCart.calculateTotal() : 0;
        var itemCount = cart.reduce(function (s, i) { return s + (i.qty || 0); }, 0);

        var countEl = document.getElementById('cartPageCount');
        if (countEl) {
          countEl.textContent = itemCount === 0
            ? 'Your cart is empty'
            : itemCount === 1 ? '1 item' : itemCount + ' items';
        }

        renderItemsColumn(cart);
        renderOrderSummary(cart, total, itemCount);
      }

      function renderItemsColumn(cart) {
        var col = document.getElementById('cartItemsColumn');
        if (!col) return;

        if (cart.length === 0) {
          col.innerHTML =
            '<div class="cart-empty-state">'
          +   '<p>You haven\'t added anything yet.</p>'
          +   '<a href="products.html" class="btn btn-ghost btn--sm">Browse the collection</a>'
          + '</div>';
          return;
        }

        var html = '';

        /* Column headings */
        html += '<div class="cart-items__heading">'
              +   '<span>Product</span>'
              +   '<span class="cart-items__heading-price">Price</span>'
              +   '<span class="cart-items__heading-qty">Qty</span>'
              +   '<span class="cart-items__heading-total">Total</span>'
              + '</div>';

        /* Items */
        html += '<ul class="cart-items__list" id="cartRowsList">';
        for (var i = 0; i < cart.length; i++) {
          var item = cart[i];
          html += '<li class="cart-row" data-id="' + escHtml(item.id) + '">'
                +   '<span class="cart-row__name">' + escHtml(item.name) + '</span>'
                +   '<span class="cart-row__price">' + formatPrice(item.price) + '</span>'
                +   '<div class="qty-control">'
                +     '<button class="qty-control__btn page-qty-dec" data-id="' + escHtml(item.id) + '" aria-label="Decrease">−</button>'
                +     '<span class="qty-control__val">' + item.qty + '</span>'
                +     '<button class="qty-control__btn page-qty-inc" data-id="' + escHtml(item.id) + '" aria-label="Increase">+</button>'
                +   '</div>'
                +   '<span class="cart-row__total">' + formatPrice(item.price * item.qty) + '</span>'
                +   '<div class="cart-row__remove">'
                +     '<button class="cart-row__remove-btn page-remove" data-id="' + escHtml(item.id) + '" aria-label="Remove item">'
                +       svgTrash()
                +     '</button>'
                +   '</div>'
                + '</li>';
        }
        html += '</ul>';

        /* Continue shopping */
        html += '<div class="cart-page__continue">'
              +   '<a href="products.html">' + svgArrowLeft() + ' Continue Shopping</a>'
              + '</div>';

        col.innerHTML = html;
        bindPageCartEvents(col);
      }

      function bindPageCartEvents(col) {
        var decBtns = col.querySelectorAll('.page-qty-dec');
        for (var d = 0; d < decBtns.length; d++) {
          (function (btn) {
            btn.addEventListener('click', function () {
              var id = btn.getAttribute('data-id');
              var cart = window.MeridianCart.getCart();
              for (var i = 0; i < cart.length; i++) {
                if (cart[i].id === id) {
                  window.MeridianCart.updateQuantity(id, cart[i].qty - 1);
                  break;
                }
              }
            });
          }(decBtns[d]));
        }

        var incBtns = col.querySelectorAll('.page-qty-inc');
        for (var n = 0; n < incBtns.length; n++) {
          (function (btn) {
            btn.addEventListener('click', function () {
              var id = btn.getAttribute('data-id');
              var cart = window.MeridianCart.getCart();
              for (var i = 0; i < cart.length; i++) {
                if (cart[i].id === id) {
                  window.MeridianCart.updateQuantity(id, cart[i].qty + 1);
                  break;
                }
              }
            });
          }(incBtns[n]));
        }

        var removeBtns = col.querySelectorAll('.page-remove');
        for (var r = 0; r < removeBtns.length; r++) {
          (function (btn) {
            btn.addEventListener('click', function () {
              window.MeridianCart.removeFromCart(btn.getAttribute('data-id'));
            });
          }(removeBtns[r]));
        }
      }

      function renderOrderSummary(cart, total, itemCount) {
        var panel = document.getElementById('orderSummary');
        if (!panel) return;

        var html = '<h2 class="order-summary__title">Order Summary</h2>';
        html += '<div class="order-summary__lines">';

        /* Line items */
        for (var i = 0; i < cart.length; i++) {
          var item = cart[i];
          html += '<div class="summary-line">'
                +   '<span class="summary-line__label">' + escHtml(item.name) + ' &times;' + item.qty + '</span>'
                +   '<span class="summary-line__value">' + formatPrice(item.price * item.qty) + '</span>'
                + '</div>';
        }

        html += '</div>';
        html += '<hr class="order-summary__divider" />';
        html += '<div class="summary-line">'
              +   '<span class="summary-line__label">Subtotal</span>'
              +   '<span class="summary-line__value">' + formatPrice(total) + '</span>'
              + '</div>';
        html += '<div class="summary-line" style="margin-top:0.5rem;">'
              +   '<span class="summary-line__label">Shipping</span>'
              +   '<span class="summary-line__value summary-line__value--tbd">Calculated at checkout</span>'
              + '</div>';
        html += '<div class="summary-line" style="margin-top:0.5rem;">'
              +   '<span class="summary-line__label">Taxes</span>'
              +   '<span class="summary-line__value summary-line__value--tbd">Calculated at checkout</span>'
              + '</div>';
        html += '<hr class="order-summary__divider" />';
        html += '<div class="summary-line summary-line--total">'
              +   '<span class="summary-line__label">Total</span>'
              +   '<span class="summary-line__value">' + formatPrice(total) + '</span>'
              + '</div>';

        html += '<button class="checkout-btn" id="pageCheckoutBtn"'
              + (itemCount === 0 ? ' disabled' : '')
              + '>Proceed to Checkout</button>';

        html += '<p class="order-summary__note">Secure checkout via Stripe.</p>';
        html += '<div class="order-summary__security">'
              +   svgLock()
              +   '<span>SSL encrypted</span>'
              + '</div>';

        panel.innerHTML = html;

        var checkoutBtn = document.getElementById('pageCheckoutBtn');
        if (checkoutBtn && itemCount > 0) {
          checkoutBtn.addEventListener('click', function () {
            window.MeridianCart.initCheckout();
          });
        }
      }

      /* Initial render */
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function () {
          /* Give cart.js a tick to finish its own DOMContentLoaded handler */
          setTimeout(renderCartPage, 0);
        });
      } else {
        setTimeout(renderCartPage, 0);
      }

      /* Re-render whenever cart changes */
      document.addEventListener('cart:updated', renderCartPage);
    }());
  </script>
</body>
</html>
